<!DOCTYPE html>
<html>
<head>
    <title>AI Work Helper</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <h1 class="text-3xl font-bold text-center mb-8">AI Work Helper</h1>
        
        <!-- Tab Navigation -->
        <div class="flex justify-center mb-6">
            <button class="tab-button px-6 py-2 rounded-t-lg bg-gray-700 text-white font-semibold transition-all duration-300" onclick="showTab('chatbot')">Chatbot</button>
            <button class="tab-button px-6 py-2 rounded-t-lg bg-gray-800 text-gray-400 font-semibold transition-all duration-300" onclick="showTab('email')">Email Responder</button>
        </div>

        <!-- Chatbot Section -->
        <div id="chatbot" class="tab-content border border-gray-700 p-6 rounded-lg shadow-xl" style="display: block;">
            <div id="chat-window" class="h-96 overflow-y-auto mb-4 p-4 bg-gray-800 rounded-lg space-y-4">
                <!-- Messages will be appended here -->
            </div>
            <div class="flex">
                <input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 px-4 py-2 rounded-l-lg bg-gray-700 border-none focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="send-chat" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-r-lg transition-colors duration-300">Send</button>
            </div>
        </div>

        <!-- Email Responder Section -->
        <div id="email" class="tab-content border border-gray-700 p-6 rounded-lg shadow-xl" style="display: none;">
            <p class="text-lg text-center mb-4">The AI Email Responder is a separate desktop application.</p>
            <p class="text-lg text-center font-bold">Please launch it manually from your computer.</p>
            <p class="text-sm text-center text-gray-400 mt-2">
                (Go to `C:\Users\indra\OneDrive\Documents\AI PROFESSIONAL EMAIL & INTERVIEW ASSISTANT\Templates\Email_Responder.py` and run the file.)
            </p>
        </div>

        <div id="status-message" class="mt-4 text-center text-sm font-semibold"></div>
    </div>

    <script>
        // Tab switching logic
        function showTab(tabId) {
            $('.tab-content').hide();
            $(`#${tabId}`).show();
            $('.tab-button').removeClass('bg-gray-700 text-white').addClass('bg-gray-800 text-gray-400');
            $(`[onclick="showTab('${tabId}')"]`).removeClass('bg-gray-800 text-gray-400').addClass('bg-gray-700 text-white');
        }

        // --- Chatbot Functionality ---
        $('#send-chat').click(function() {
            let userInput = $('#chat-input').val().trim();
            if (userInput === '') return;

            // Display user message
            $('#chat-window').append('<div class="bg-blue-600 text-white p-3 rounded-lg self-end max-w-md ml-auto">' + userInput + '</div>');
            $('#chat-input').val('');
            $('#chat-window').scrollTop($('#chat-window')[0].scrollHeight);

            // Display thinking message
            let thinkingDiv = $('<div id="thinking-message" class="bg-gray-700 text-gray-400 p-3 rounded-lg self-start max-w-md mr-auto">Thinking...</div>');
            $('#chat-window').append(thinkingDiv);
            $('#chat-window').scrollTop($('#chat-window')[0].scrollHeight);

            // Send POST request to backend
            $.ajax({
                url: '/chat',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ text: userInput }),
                success: function(response) {
                    $('#thinking-message').remove();
                    $('#chat-window').append('<div class="bg-gray-700 text-gray-200 p-3 rounded-lg self-start max-w-md mr-auto">' + response.response + '</div>');
                    $('#chat-window').scrollTop($('#chat-window')[0].scrollHeight);
                },
                error: function(xhr, status, error) {
                    $('#thinking-message').remove();
                    // Handle non-JSON responses gracefully to prevent the TypeError
                    const errorMessage = (xhr.responseJSON && xhr.responseJSON.error) ? xhr.responseJSON.error : 'An unknown error occurred. Please check the server logs.';
                    $('#chat-window').append('<div class="bg-red-500 text-white p-3 rounded-lg self-start max-w-md mr-auto">Error: ' + errorMessage + '</div>');
                    $('#chat-window').scrollTop($('#chat-window')[0].scrollHeight);
                }
            });
        });

        $('#chat-input').keypress(function(e) {
            if (e.which === 13) {
                $('#send-chat').click();
            }
        });
    </script>
</body>
</html>
